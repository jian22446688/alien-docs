<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>前端性能监控 | ele-alien-前端常用的工具库</title>
    <meta name="description" content="element 超强组件组合">
    <link rel="icon" href="/alien-docs/favicon.ico">
    
    <link rel="preload" href="/alien-docs/assets/css/0.styles.384d5879.css" as="style"><link rel="preload" href="/alien-docs/assets/js/app.78579c0a.js" as="script"><link rel="preload" href="/alien-docs/assets/js/3.8803fd96.js" as="script"><link rel="preload" href="/alien-docs/assets/js/2.79d395db.js" as="script"><link rel="preload" href="/alien-docs/assets/js/47.d4c0b1a4.js" as="script"><link rel="prefetch" href="/alien-docs/assets/js/10.e34ef9ba.js"><link rel="prefetch" href="/alien-docs/assets/js/11.178bb7e7.js"><link rel="prefetch" href="/alien-docs/assets/js/12.09d9c501.js"><link rel="prefetch" href="/alien-docs/assets/js/13.35007b5f.js"><link rel="prefetch" href="/alien-docs/assets/js/14.f091fc2a.js"><link rel="prefetch" href="/alien-docs/assets/js/15.63365744.js"><link rel="prefetch" href="/alien-docs/assets/js/16.c7398b82.js"><link rel="prefetch" href="/alien-docs/assets/js/17.b06aa20c.js"><link rel="prefetch" href="/alien-docs/assets/js/18.5797f8a7.js"><link rel="prefetch" href="/alien-docs/assets/js/19.fa664676.js"><link rel="prefetch" href="/alien-docs/assets/js/20.7a383b5e.js"><link rel="prefetch" href="/alien-docs/assets/js/21.e8be06fc.js"><link rel="prefetch" href="/alien-docs/assets/js/22.1d538b4f.js"><link rel="prefetch" href="/alien-docs/assets/js/23.d0ed2813.js"><link rel="prefetch" href="/alien-docs/assets/js/24.f0434a51.js"><link rel="prefetch" href="/alien-docs/assets/js/25.c84ba3de.js"><link rel="prefetch" href="/alien-docs/assets/js/26.38c77aaf.js"><link rel="prefetch" href="/alien-docs/assets/js/27.2e5bca12.js"><link rel="prefetch" href="/alien-docs/assets/js/28.315eb217.js"><link rel="prefetch" href="/alien-docs/assets/js/29.88af7105.js"><link rel="prefetch" href="/alien-docs/assets/js/30.981272cc.js"><link rel="prefetch" href="/alien-docs/assets/js/31.f13bd464.js"><link rel="prefetch" href="/alien-docs/assets/js/32.6acf583e.js"><link rel="prefetch" href="/alien-docs/assets/js/33.47a81871.js"><link rel="prefetch" href="/alien-docs/assets/js/34.6dfb1720.js"><link rel="prefetch" href="/alien-docs/assets/js/35.c713c9cc.js"><link rel="prefetch" href="/alien-docs/assets/js/36.d4089f3e.js"><link rel="prefetch" href="/alien-docs/assets/js/37.574bbc3e.js"><link rel="prefetch" href="/alien-docs/assets/js/38.7b42dfe1.js"><link rel="prefetch" href="/alien-docs/assets/js/39.5a07aeae.js"><link rel="prefetch" href="/alien-docs/assets/js/4.8041613d.js"><link rel="prefetch" href="/alien-docs/assets/js/40.171e1f72.js"><link rel="prefetch" href="/alien-docs/assets/js/41.6f6df253.js"><link rel="prefetch" href="/alien-docs/assets/js/42.c7f1ce57.js"><link rel="prefetch" href="/alien-docs/assets/js/43.73deeafc.js"><link rel="prefetch" href="/alien-docs/assets/js/44.8ce22a2c.js"><link rel="prefetch" href="/alien-docs/assets/js/45.2fd200c5.js"><link rel="prefetch" href="/alien-docs/assets/js/46.46eb8890.js"><link rel="prefetch" href="/alien-docs/assets/js/48.1bf9bd74.js"><link rel="prefetch" href="/alien-docs/assets/js/49.c1b4e20a.js"><link rel="prefetch" href="/alien-docs/assets/js/5.b1c96403.js"><link rel="prefetch" href="/alien-docs/assets/js/50.e3d082be.js"><link rel="prefetch" href="/alien-docs/assets/js/51.27da2b5a.js"><link rel="prefetch" href="/alien-docs/assets/js/52.c731b1e2.js"><link rel="prefetch" href="/alien-docs/assets/js/53.ee475197.js"><link rel="prefetch" href="/alien-docs/assets/js/54.1c33b987.js"><link rel="prefetch" href="/alien-docs/assets/js/55.385e1cd2.js"><link rel="prefetch" href="/alien-docs/assets/js/56.7ac891d2.js"><link rel="prefetch" href="/alien-docs/assets/js/57.44a038df.js"><link rel="prefetch" href="/alien-docs/assets/js/58.798e214f.js"><link rel="prefetch" href="/alien-docs/assets/js/59.2ac13029.js"><link rel="prefetch" href="/alien-docs/assets/js/6.d8da06e5.js"><link rel="prefetch" href="/alien-docs/assets/js/60.73fa704d.js"><link rel="prefetch" href="/alien-docs/assets/js/61.3f55ea2d.js"><link rel="prefetch" href="/alien-docs/assets/js/62.39e3028e.js"><link rel="prefetch" href="/alien-docs/assets/js/63.eb68e2c2.js"><link rel="prefetch" href="/alien-docs/assets/js/64.1c609fc1.js"><link rel="prefetch" href="/alien-docs/assets/js/65.c35a1149.js"><link rel="prefetch" href="/alien-docs/assets/js/66.b51f71f4.js"><link rel="prefetch" href="/alien-docs/assets/js/67.46c5ea37.js"><link rel="prefetch" href="/alien-docs/assets/js/68.f57739e8.js"><link rel="prefetch" href="/alien-docs/assets/js/69.88cb6a75.js"><link rel="prefetch" href="/alien-docs/assets/js/7.19258870.js"><link rel="prefetch" href="/alien-docs/assets/js/70.85e5e87b.js"><link rel="prefetch" href="/alien-docs/assets/js/71.4738ca8f.js"><link rel="prefetch" href="/alien-docs/assets/js/72.33e0a806.js"><link rel="prefetch" href="/alien-docs/assets/js/73.d0242822.js"><link rel="prefetch" href="/alien-docs/assets/js/74.f5576592.js"><link rel="prefetch" href="/alien-docs/assets/js/75.33ba337e.js"><link rel="prefetch" href="/alien-docs/assets/js/76.4368f768.js"><link rel="prefetch" href="/alien-docs/assets/js/77.71e58ec3.js"><link rel="prefetch" href="/alien-docs/assets/js/78.59fdc143.js"><link rel="prefetch" href="/alien-docs/assets/js/79.20f0a177.js"><link rel="prefetch" href="/alien-docs/assets/js/8.9a462668.js"><link rel="prefetch" href="/alien-docs/assets/js/9.45b9096c.js">
    <link rel="stylesheet" href="/alien-docs/assets/css/0.styles.384d5879.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/alien-docs/" class="home-link router-link-active"><!----> <span class="site-name">ele-alien-前端常用的工具库</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/alien-docs/" class="nav-link">欢迎光临</a></div><div class="nav-item"><a href="/alien-docs/alien-commponent/" class="nav-link">超强组件</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">前端工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/alien-docs/web-nav/" class="nav-link">前端导航</a></li><li class="dropdown-item"><!----> <a href="/alien-docs/repository/" class="nav-link">开源项目</a></li><li class="dropdown-item"><!----> <a href="/alien-docs/website/" class="nav-link">前端网址</a></li><li class="dropdown-item"><!----> <a href="/alien-docs/code/" class="nav-link">代码片段</a></li><li class="dropdown-item"><!----> <a href="/alien-docs/web/" class="nav-link">前端摸金</a></li><li class="dropdown-item"><!----> <a href="/alien-docs/webpack/" class="nav-link">Webpack</a></li></ul></div></div><div class="nav-item"><a href="/alien-docs/article/" class="nav-link">热门文章</a></div> <a href="https://github.com/jian22446688/ele-alien" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/alien-docs/" class="nav-link">欢迎光临</a></div><div class="nav-item"><a href="/alien-docs/alien-commponent/" class="nav-link">超强组件</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">前端工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/alien-docs/web-nav/" class="nav-link">前端导航</a></li><li class="dropdown-item"><!----> <a href="/alien-docs/repository/" class="nav-link">开源项目</a></li><li class="dropdown-item"><!----> <a href="/alien-docs/website/" class="nav-link">前端网址</a></li><li class="dropdown-item"><!----> <a href="/alien-docs/code/" class="nav-link">代码片段</a></li><li class="dropdown-item"><!----> <a href="/alien-docs/web/" class="nav-link">前端摸金</a></li><li class="dropdown-item"><!----> <a href="/alien-docs/webpack/" class="nav-link">Webpack</a></li></ul></div></div><div class="nav-item"><a href="/alien-docs/article/" class="nav-link">热门文章</a></div> <a href="https://github.com/jian22446688/ele-alien" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="前端性能监控"><a href="#前端性能监控" class="header-anchor">#</a> 前端性能监控</h2> <blockquote><p>2019.02.24</p></blockquote> <p>前端性能监控分为两种方式，一种叫做合成监控（Synthetic Monitoring，SYN），另一种是真实用户监控（Real User Monitoring，RUM）。</p> <h3 id="合成监控"><a href="#合成监控" class="header-anchor">#</a> 合成监控</h3> <p>什么叫合成监控？就是在一个模拟场景里，去提交一个需要做性能审计的页面，通过一系列的工具、规则去运行你的页面，提取一些性能指标，得出一个审计报告。</p> <p>常见的工具有 Google 的 Lighthouse，webpagetest，pagespeed 等。</p> <p>当然其实业界对于 Lighthouse 也是评价有褒有贬，因为 Google 借助这个看似中立的性能评审工具也是在推行它的一些技术的方案。 比如你的页面如果没有支持 PWA 评分就不会很高。</p> <ul><li>合成监控的优缺点</li></ul> <table><thead><tr><th style="text-align:center;">优点</th> <th style="text-align:center;">缺点</th></tr></thead> <tbody><tr><td style="text-align:center;">实现简单</td> <td style="text-align:center;">无法还原全部真实场景</td></tr> <tr><td style="text-align:center;">能采集到丰富的数据，如硬件指标或瀑布图</td> <td style="text-align:center;">登录等场景需要额外解决</td></tr> <tr><td style="text-align:center;">不影响真实用户的访问性能</td> <td style="text-align:center;">单次数据不够稳定</td></tr> <tr><td style="text-align:center;">可以提供页面加载幻灯片等可视化分析途径</td> <td style="text-align:center;">数据量较小，无法发挥更大价值</td></tr></tbody></table> <h3 id="真实用户监控"><a href="#真实用户监控" class="header-anchor">#</a> 真实用户监控</h3> <p>所谓真实用户监控，就是用户在我们的页面访问之后就会产生各种各样的性能指标，之后会将这些性能指标上传的我们的日志服务器上，进行数据的提起清洗加工，最后在我们的监控平台上进行展示和分析的一个过程。</p> <ul><li>真实用户监控的优缺点</li></ul> <table><thead><tr><th style="text-align:center;">优点</th> <th style="text-align:center;">缺点</th></tr></thead> <tbody><tr><td style="text-align:center;">无需配置模拟条件，完全还原真实场景</td> <td style="text-align:center;">一定程度影响真实用户的访问性能及流量消耗</td></tr> <tr><td style="text-align:center;">不存在登录等需要额外解决的场景</td> <td style="text-align:center;">无法采集硬件相关指标</td></tr> <tr><td style="text-align:center;">数据样本足够庞大，可以减少统计误差</td> <td style="text-align:center;">受传输限制无法采集完整的资源加载瀑布图</td></tr> <tr><td style="text-align:center;">新年数据可与其它数据关联，产生更大价值</td> <td style="text-align:center;">无法可视化展示加载过程</td></tr></tbody></table> <h3 id="对比"><a href="#对比" class="header-anchor">#</a> 对比</h3> <table><thead><tr><th style="text-align:center;">对比项</th> <th style="text-align:center;">合成监控</th> <th style="text-align:center;">真实用户监控</th></tr></thead> <tbody><tr><td style="text-align:center;">实现难度及成本</td> <td style="text-align:center;">较低</td> <td style="text-align:center;">较高</td></tr> <tr><td style="text-align:center;">采集数据丰富度</td> <td style="text-align:center;">丰富</td> <td style="text-align:center;">基础</td></tr> <tr><td style="text-align:center;">数据样本量</td> <td style="text-align:center;">较小</td> <td style="text-align:center;">大(视业务体量)</td></tr> <tr><td style="text-align:center;">适合场景</td> <td style="text-align:center;">团队自由业务，对性能做定性分析，或配合 CI 做小数据量的监控分析</td> <td style="text-align:center;">作为中台产品支持前台业务，对性能做定量分析，结合业务数据进行深度挖掘</td></tr></tbody></table> <h3 id="方案"><a href="#方案" class="header-anchor">#</a> 方案</h3> <p>在真实用户性能数据采集时，要关注四个方面的东西：</p> <ul><li><p>使用标准的 API</p></li> <li><p>定义合适的指标</p></li> <li><p>采集正确的数据</p></li> <li><p>上报关联的维度</p></li></ul> <h4 id="使用标准的-api"><a href="#使用标准的-api" class="header-anchor">#</a> 使用标准的 API</h4> <p>之前大家都使用一个叫 <code>performance.timing</code>，来做性能监控。但这个 API 已经“废弃”了。为什么会被废弃？因为 W3C 给我们提供了更全面、更强大的一个性能分析矩阵，比单一的 performance.timing 更加强大，能帮助我们从各个方面分析前端页面性能。</p> <p>采集性能数据时先抹平 Navigation Timing spec 差异，优先使用 PerformanceTimeline API(在复杂场景，亦可考虑优先使用 PerformanceObserver)。</p> <h4 id="定义合适的指标"><a href="#定义合适的指标" class="header-anchor">#</a> 定义合适的指标</h4> <p>First Meaningful Paint，首次有效渲染时长，这个指标最早是由 Google 提出的，它的一个核心的想法是渲染并不一定代表着用户看到了主要内容，Load 也不一定代表用户看到主要内容，那用户什么时候能够看到主要内容呢？我们假设当一个网页的 DOM 结构发生剧烈的变化的时候，就是这个网页主要内容出现的时候，那么在这样的一个时间点上，就是用户看到主要内容的一个时间点。</p> <p>它的优点是相对校准的估算出内容渲染时间，贴近用户感知。但缺点是无原生 API 支持，算法推导时 DOM 节点不含权重。</p> <h4 id="怎样采集正确的数据？"><a href="#怎样采集正确的数据？" class="header-anchor">#</a> 怎样采集正确的数据？</h4> <p>上报页⾯加载开始时间，以及后续各时间点相对增量，在数据端进行阶段清洗和异常处理。</p> <h4 id="上报关联的维度"><a href="#上报关联的维度" class="header-anchor">#</a> 上报关联的维度</h4> <p>我们都知道在做前端的数据采集的时候，维度数据是非常重要的，除了我们刚才定义的各种度量，怎样采集到合适的相关维度，也能够极大地帮助我们分析页面性能的效果。</p> <p>在分析页面性能的时候，有很多相对专业的维度是会被大家忽略掉的，比如说当前页面是否可见，这个页面加载方式是怎么样的，它是直接打开，还是刷新打开，还是前进后退打开等等。就是通过后面的数据分析，我们会发现，不同的页面操作，页面打开方式都会对我们页面加载的性能会有影响，以及一些更复杂的，比如说是否启用 HTTP2、Service Worker 等等，这些数据我们都应该尽可能采集到，从而能够更好的去分析我们的页面性能。</p> <h3 id="原文"><a href="#原文" class="header-anchor">#</a> 原文</h3> <p>本文为<a href="https://mp.weixin.qq.com/s?__biz=MzUxMzcxMzE5Ng==&amp;mid=2247490527&amp;idx=1&amp;sn=cc2549683b3ff69c042483d78ced766a&amp;chksm=f951ae9cce26278a263ecf2937b5c4957c9b37f35b7efe4c1a8c6ab69c74ebcb43c54e62abda&amp;token=1927326837&amp;lang=zh_CN#rd" target="_blank" rel="noopener noreferrer">蚂蚁金服如何把前端性能监控做到极致?<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 的阅读笔记。</p> <p>拓展阅读 <a href="https://zhuanlan.zhihu.com/p/33825610" target="_blank" rel="noopener noreferrer">我理解的前端性能 &amp; 优化<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/jian22446688/ele-alien/edit/master/docs/blog/performance .md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">10/16/2019, 9:39:50 AM</span></div></footer> <!----> </main></div><div class="global-ui"><!----><div id="live2d-widget" class="live2d-widget-container" style="position:fixed;right:65px;bottom:0px;width:135px;height:231px;z-index:99999;opacity:0.8;pointer-events:none;"><canvas id="live2dcanvas" width="135" height="231" class="live2dcanvas" style="position:absolute;left:0px;top:0px;width:135px;height:231px;"></canvas></div></div></div>
    <script src="/alien-docs/assets/js/app.78579c0a.js" defer></script><script src="/alien-docs/assets/js/3.8803fd96.js" defer></script><script src="/alien-docs/assets/js/2.79d395db.js" defer></script><script src="/alien-docs/assets/js/47.d4c0b1a4.js" defer></script>
  </body>
</html>
